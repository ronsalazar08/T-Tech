{% extends "T_Tech/base_iboard.html" %}
{% csrf_token %}
{% block content %}
    
    <div class="row ml-1 mr-1 " style="height: 1000px; ">
        <div class="col-6 rounded">
            <table id="table" class="table table-striped table-bordered font-weight-bold p-0 mx-auto mt-1 mb-0 shadow h-100" style="border-radius:5px; overflow: hidden; table-layout: fixed; border-collapse: collapse; width:100%">
                <thead class="thead-dark">
                    <tr>
                        <th style="width:5%"></th>
                        <th style="width:50%">NAME</th>
                        <th style="width:25%">POSITION</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in emps %}
                        <tr>
                            <td style="width:5%; padding:10px 5px; vertical-align:middle; text-align: center; font-size: 20px;"  >{{emp.status}}</td>
                            <td class="" style="width:50%; font-size: 24px; vertical-align:middle;">{{emp.firstname}} {{ emp.middlename|make_list|first }}. {{emp.lastname}}</td>
                            <td class="font-weight-normal" style="width: 25%; font-size: 15px; vertical-align:middle;">{{emp.position}}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-6 p-0 pr-2">
            <center><div class="font-weight-bolder" style="font-size: 18px;">{{month}}</div></center>
            <div class=" w-100 mb-4" style=" height:580px;">
                <table id="tablea" class="shadow p-0 mx-auto h-100" style="font-size:8px;">
                    <thead >
                        <tr>
                            <th></th>
                            <th style="width:25%">NAME</th>
                            {% for c in count %}
                                <th class="text-center">{{ forloop.counter }}</th>
                            {% endfor %}
                            {% comment %} <th class="text-center">L</th> {% endcomment %}
                            <th class="text-center">A</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for m in mons %}
                            <tr>
                                <td class="text-center font-weight-bold">{{ forloop.counter }}</td>
                                <td class="font-weight-bold" style="font-size: 14px;">{{m.name}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d1|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d2|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d3|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d4|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d5|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d6|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d7|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d8|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d9|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d10|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d11|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d12|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d13|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d14|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d15|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d16|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d17|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d18|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d19|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d20|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d21|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d22|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d23|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d24|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d25|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d26|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d27|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d28|default_if_none:""}}</td>
                                <td class="dd text-center" style="font-size: 11px;">{{m.d29|default_if_none:""}}</td>
                                {% if cnt == 30 %}
                                <td class="dd pl-1">{{m.d30}}</td>
                                {% elif cnt == 31 %}
                                <td class="dd pl-1">{{m.d30}}</td>
                                <td class="dd pl-1">{{m.d31}}</td>
                                {% endif %}
                                {% comment %} <td style="width: 20px; padding-left:5px; padding-right:5px; text-align: center; font-weight: bolder;" class="Ltot"></td> {% endcomment %}
                                <td style="width: 20px; padding-left:5px; padding-right:5px; text-align: center; font-weight: bolder;" class="Atot"></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div style="position: absolute; bottom: 350px; right: 380px; font-size: 14px; font-weight:bold;">
                <b style="color:LimeGreen;">&#11044;</b> PRESENT &emsp;&emsp; <b style="color:red;">&#11044;</b> ABSENT
            </div>
            <div class="w-100 mt-1 text-center font-weight-bold mb-2" style="border: solid 2px #292b2c; border-radius: 12px; overflow:hidden; height:170px; text-align: center; display: flex; justify-content: center; align-items: center;">
                <!--<iframe id="myIframe" name="myIframe" src=""  frameBorder: 0; scrolling="no" ></iframe>-->
                <span id="info_div" style="font-size: 72px; font-weight: bold;"></span>OF EMPLOYEES ARE PRESENT
            </div>
            <div >
                <input id="inputBox" type="text" autofocus onkeypress="return searchKeyPress(event);" style="position:absolute; bottom:0px; right:0px; border:0; outline:none; background-color: inherit; color:transparent;" required>
                <div id="date" class="mx-auto text-center font-weight-bolder" style="font-size: 30px;"></div>
                <div id="time" class="shadow-lg mx-auto text-center font-weight-bolder" style="font-size: 102px; border: solid 2px #292b2c; border-radius: 12px;"></div>
                
            </div>
        </div>    
    </div>
    <style>
    </style>
    <script type="text/javascript">
        $(document).ready(function(){
            $('body').click(function(){
                $('#inputBox').focus();
            });

            var p = 0;
            $('#table tbody tr').each(function(){
                var status = $(this).find(':nth-child(1)').text();
                if (status == "P") {
                    p += 1;
                    $(this).find(':nth-child(1)').html('&#11044;');
                    $(this).find(':nth-child(1)').css('color','LimeGreen');
                } else if (status == "L") {
                    p += 1;
                    $(this).find(':nth-child(1)').html('&#11044;');
                    $(this).find(':nth-child(1)').css('color','Yellow');
                } else {
                    $(this).find(':nth-child(1)').html('&#11044;');
                    $(this).find(':nth-child(1)').css('color','Red');
                }
            });

            $('#tablea tbody tr').each(function () {
                var Ltot = 0;
                var Atot = 0;
                $(this).find('.dd').each(function () {
                    var valu = $(this).text();
                    if (valu == 'A'){
                        Atot += 1;
                        $(this).html('&#11044;');
                        $(this).css('color','Red');
                    {% comment %} } else if (valu == 'L'){
                        Ltot += 1;
                        $(this).html('&#11044;');
                        $(this).css('color','Yellow'); {% endcomment %}
                    } else if (valu == 'P'){
                        $(this).html('&#11044;');
                        $(this).css('color','LimeGreen');
                    }
                });

                //set the value of currents rows sum to the total-combat element in the current row
                if (Atot != 0){
                    $('.Atot', this).html(Atot);
                }
                if (Ltot != 0){
                    $('.Ltot', this).html(Ltot);
                }
            });
            percent = parseFloat(p/{{counta}} * 100).toFixed(0);
            $('#info_div').text(percent + '%');
            
            {% comment %} if ({{hour}} <= 11){
                ajaxa();
            } {% endcomment %}
            ajaxa();
            startTime();
        });

        function resizeIframe(obj) {
            obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
        }

        function ajaxa() {
            $.post("{% url 'reload' %}",{csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()}, function(resp){
                if (resp == "reload") {
                    window.location.reload();
                }
            },);
        setTimeout(ajaxa, 500);
        }

        function searchKeyPress(e) {
			e = e || window.event;
			if (e.keyCode == 13)
			{
				var val = $("#inputBox").val();
                window.location.href="http://127.0.0.1:8000/iboard/display/"+val;
				return false;
			}
			return true;
		}
        
		function klik() {
			$("#inputBox").focus();
		}
        
        var holder = '';
        function startTime() {
			//time
			var today = new Date();
			var ha = today.getHours();
			var h = today.getHours();
			var m = today.getMinutes();
			var s = today.getSeconds();
			var ampm = h >= 12 ? "PM" : "AM";
			h = h % 12;
			h = h ? h : 12; // the hour '0' should be '12'
			h = checkTime(h);
			m = checkTime(m);
			//s = checkTime(s);
            if (ha>=7 && holder==''){
                //window.location.href = 'http://localhost:2000/bday';
                holder = setTimeout(function(){window.location.href = "{% url 'bday' %}";}, 60000);
            }
			document.getElementById("time").innerHTML =
			h + ":" + m + " " + ampm;
            //h + ":" + m + ":" + s + " " + ampm;
			var t = setTimeout(startTime, 500);
            
			//date
			var months = new Array(12);
			months[0] = "January";
			months[1] = "February";
			months[2] = "March";
			months[3] = "April";
			months[4] = "May";
			months[5] = "June";
			months[6] = "July";
			months[7] = "August";
			months[8] = "September";
			months[9] = "October";
			months[10] = "November";
			months[11] = "December";
			
			n =  new Date();
			y = n.getFullYear();
			m = n.getMonth();
			
			d = n.getDate();
			document.getElementById("date").innerHTML = months[m] + " " + d + ", " + y;
		}

		function checkTime(i) {
			if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
			return i;
		}

        {% comment %} var frames = Array('http://localhost:8000/kanban/list', 25, 'http://localhost:2000/month', 25);
		var i = 0, len = frames.length;
		function ChangeSrc()
			{
			if (i >= len) { i = 0; } // start over
			  //document.getElementById('myIframe').src = frames[i++];
			  windows.location.href = frames[i++];
              setTimeout('ChangeSrc()', (frames[i++]*1000));
			} {% endcomment %}
    </script>
{% endblock content %}
